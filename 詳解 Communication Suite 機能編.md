# 詳解 Communication Suite 機能編
## 誰も知らない Communication Suite の謎

なんかかきますか？  
謎です。デスクトップから編集。もう一回。  
ノートで修正、もう一回。改行した。  
更にデスクトップ。。

## 目次

## 序章 トレーニングにあたって

### トレーニングの目的

- SI パートナー様及び Communication Suite ユーザ様に、Communication Suite の 各種機能を詳細に解説します。

### トレーニング中の諸注意
- 本トレーニングの受講資料及び内容を貴社外へ共有・配布することは禁止となります。
- 本トレーニングの内容の撮影・録音は原則として禁止となります。
- 一部、受講中の資料を補足した板書の内容などの撮影は可能ですが、講師の許可を得た上でお願い致します。
- 本資料の記載内容は、現時点（2020年03月 Communication Suite Ver3.6）での内容となります。  
  今後にリリースされるバージョンでは、記載内容が保証されない場合も生じます。

## 第1章 OperatorAgent

### 1-1. OperatorAgent のログイン
#### 1-1-1. OperatorAgent でログインすることの意味
1. ユーザアカウントの認証（ユーザ ID と パスワード）
2. ユーザアカウント権限のチェック
3. ユーザと通話（内線番号）の関連付け
4. 通話とプロジェクトの関連付け
5. クライアント PC を OperatorAgent ノードとして ControlCenter にレジスト

 以下の図は、OperatorAgent の基本的なログイン画面となります。
![1-1_OperatorAgent_BaseLogin](images/1-1-operatoragent-baselogin.png)

#### 1-1-2. OperatorAgent のログイン機能に関連する ControlCenter の詳細設定項目

No. | 設定分類                 | 設定項目名       | デフォルト値 | 内容 |
----|---------------------|------------------|--------------|------|
1   | OperatorAgent - ログイン | ユーザーIDの保存 | false        | 最後にログイン成功した ユーザ ID を保存する |
2   | OperatorAgent - ログイン | パスワードの保存 | false        | 最後にログイン成功したパスワードを保存する |
3   | OperatorAgent - ログイン | 自動ログイン | false        | 保存済みのユーザ ID とパスワード（と内線番号）で自動ログインする |
4   | OperatorAgent - ログイン | 内線番号の指定 | false        | ログインダイアログに内線番号入力欄を表示する |
5   | OperatorAgent - ログイン | 内線番号の情報が必要かどうか | S        | R = 必須, S = サーバ版では必須, N = 入力しない |
6   | OperatorAgent - ログイン | 内線番号の保存 | false        | 最後にログイン成功した内線番号を保存する |

 - No.4 『内線番号の指定』 を **"true"** にすることでログインダイアログに内線番号入力欄が追加されます。（VDI などシンクライアント環境で、OS に固有情報を保持できない場合に利用する想定です。）
![1-1-operatoragent-naisenlogin](images/2020/02/1-1-operatoragent-naisenlogin.png)
 - OperatorAgent のインストール時に内線番号を指定している場合には、指定番号が内線番号入力欄に表示されます。（No.6 『内線番号の保存』 が **"false"** の場合も表示されます。）
 - No.4 『内線番号の指定』 が **"false"** の場合でも、インストール時に内線番号が指定されていない場合で、かつ No.5 『内線番号の情報が必要かどうか』 が "S" でかつサーバ版利用 or "R" の場合には、内線番号入力欄が強制的に表示されます。
 - No.1, No.2, No.6 は、Windows の [ユーザーアカウント]-[資格情報マネージャー]-[Windows資格情報の管理]-[汎用資格情報] に保管されます。一度でも利用 PC でログインに成功している場合は、以降のログイン時には操作なしで OperatorAgent にログインできます。初めて利用する PC や、パスワードを再設定した場合には、一度手動ログインを実施してください。

#### 1-1-3. プロジェクトの選択
- ログインするユーザ ID が複数のプロジェクトに所属している場合には、ログインダイアログに続けてプロジェクト選択ダイアログが表示されます。
![1-1-operatoragent-projectchoice](images/2020/02/1-1-operatoragent-projectchoice.png)

#### 1-1-4. 統合 Windows 認証

 - 統合 Windows 認証機能を有効化している場合には、ログイン画面は表示されません。ただし、ユーザがプロジェクトに複数所属している場合には、[1-1-3. プロジェクトの選択](#1-1-3-選択) のプロジェクト選択ダイアログが表示されます。
 - インストール時に内線番号が指定されていない場合には、内線番号の入力欄のみのダイアログが追加表示されます。
![1-1-operatoragent-naienonly](images/1-1-operatoragentLogin_naisenonly.png)

- 統合 Windows 認証を利用するための Communication Suite 上の設定はありませせん。以下、IIS 上でいくつか追加の設定が必要です。
	1. OS の "機能と役割の追加" から IIS - Web サーバ - セキュリティ 設定で **Windows 認証** を有効化してください。

	![1-1-IIS_role_windowslogin](images/1-1-IIS_role_windowslogin.png)
	2. IIS マネージャーの Web サイトの設定で、ControlCenter と SpeechVisualizer のそれぞれのサイトの認証の設定を以下の図と同様に変更します。

	![1-1-IIS_sitegonfig_login](images/1-1-IIS_sitegonfig_login.png)

#### 1-1-5. OperatorAgent へのログイン失敗事由
- OperatorAgent にログインできない原因を以下に列挙します。ただし、仕様によりログインできなかった事由に限定しています。（NW 切断やサーバシャットダウンは含んでいません。）

No. | 事由                 | ログインダイアログのメッセージ       | デバッグログへの出力 |
----|---------------------|------------------|--------------|
1   | ユーザ ID 誤り | OperatorAgent サービスにログインできませんでした | ステータス: 43031 ユーザID 'XXX'、またはパスワードが違います。 |
2   | パスワード誤り | OperatorAgent サービスにログインできませんでした | ステータス: 43031 ユーザID 'XXX'、またはパスワードが違います。 |
3   | 内線番号誤り | OperatorAgent サービスにログインできませんでした | ステータス: 42601 指定した内線番号 'NNN' は削除されたか、登録されていません。 |
4   | 所属プロジェクト無し | 所属するプロジェクトがありません | 出力無し|
5   | OperatorAgent の利用権限無し | OperatorAgent サービスにログインできませんでした | ステータス: 43207 権限のあるプロジェクトがありません。 |
6   | ユーザの有効期限切れ | OperatorAgent サービスにログインできませんでした | ステータス: 43031 ユーザID 'XXX'、またはパスワードが違います。 |
7   | ユーザの重複ログイン | このユーザは他の PC で利用中です | 43204 ユーザは別のホストからすでにログインしています。 |
8   | 内線番号の重複ログイン | OperatorAgent サービスにログインできませんでした | ステータス: 43205 指定された回線は現在使用されています。 |
9   | Communication Suite ユーザ未登録 | OperatorAgent サービスにログインできませんでした | このエラーは、IIS に入力されたユーザー名またはパスワードが無効であるか、または IIS がユーザーを認証するのためにそのユーザー名およびパスワードを使用できないときに発生します。 |
10   | ライセンス違反 | OperatorAgent サービスにログインできませんでした | 【要確認】 ステータス: XXXXX ○○○。 |


※ 1、2 は **フォーム認証利用時のみ** のエラーとなります。  
※ 9 は **統合 Windows 認証利用時のみ** のエラーとなります。

#### 1-1-6. 1-1 のまとめ
- [ ] OperatorAgent でのログインに関わる設定項目について理解ができた。
- [ ] OperatorAgent でのログインが単に認証しているだけでは無いことが理解できた。
- [ ] OperatorAgent にログインできないときに原因の切り分けができそうだ。

### 1-2. OperatorAgent のメイン画面
#### 1-2-1. メイン画面機能
![2-1-operatoragentMain](images/2-1-operatoragentMain.png)
 1. OperatorAgent バージョン確認  
 画面の左上の OperatorAgent ロゴを右クリックすると表示されるメニューから OperatorAgent のバージョンを確認することができます。
 ![2-1-operatoragent_versionmenu](images/2-1-operatoragent_versionmenu.png)
 ![2-1-operatoragent_version](images/2-1-operatoragent_version.png)
 2. 通話リスト  
 指定した検索条件に適合する SpeechVisualizer の通話詳細へのリンクをリストアップします。通話リストに関連する ControlCenter の詳細設定項目は以下です。

 No. | 設定分類                 | 設定項目名       | デフォルト値 | 内容 |
----|---------------------|------------------|--------------|------|
1   | OperatorAgent - 通話 | 検索条件 | mine:* d:1d | 今日の自分の通話 |
2   | OperatorAgent - 通話 | 最大表示件数 | 20 | 上位２０件まで |

 ※ 検索条件の書式は SpeechVisualizer の通話検索条件と同じ書式が利用できます。

 3. マイクエリ  
 SpeechVisualizer の通話検索機能で設定したマイクエリへのリンク（マイクエリの条件で検索した状態の検索画面へのリンク）をリストアップします。
 4. メッセージ  
 チャット機能です。  
 `利用のヒント`  
    オペレータ同士のチャットは禁止するが、座席表モニタ中の SV とのチャットのみ許可したい場合には、ロールに付与する権限  "OperatorAgent からのメッセージ送信" を付与しないことにより、OperatorAgent からユーザを検索・指定してのメッセージ送信ができなくなります。  
![2-1-message_authok](images/2-1-message_authok.png) 権限があると宛先検索が有効です。

	![2-1-message_authng](images/2-1-message_authng.png) 権限が無いと宛先検索ができません。

	![2-1-operatoragent_messagewindow](images/2-1-operatoragent_messagewindow.png)   
	管理者から受信したメッセージに対して返信は可能です。

	![2-1-message_authngrireki](images/2-1-message_authngrireki.png)   
	メッセージウィンドウにチャット履歴が残っている期間（受信後24時間以内）であれば、メッセージ受信履歴からの宛先指定が可能です。

 メッセージに関連する ControlCenter の詳細設定項目は以下です。

 No. | 設定分類                 | 設定項目名       | デフォルト値 | 内容 |
----|---------------------|------------------|--------------|------|
1   | OperatorAgent - メッセージ | Enter キーでメッセージを送信 | true |  |
2   | OperatorAgent - メッセージ | ヘルプ対応時にメッセージウインドウを自動的に開く | true |  |

 `メッセージの保存期間`  
メッセージは、通話中にも非通話時にも送受信できます。
  - 通話中のメッセージ - 通話の付加情報として扱われます。通話データが削除されるタイミングで消去されます。
  - 非通話中のメッセージ - 単純チャット情報として扱われます。24時間後に消去されます。  
      **通話中のメッセージも非通話中のメッセージも閲覧する機能はありません。**


 5. お知らせ  
 ControlCenter のお知らせ管理で登録されたお知らせをリストアップします。お知らせに関連する ControlCenter の詳細設定項目は以下です。

 No. | 設定分類                 | 設定項目名       | デフォルト値 | 内容 |
----|---------------------|------------------|--------------|------|
1   | OperatorAgent - お知らせ | 更新間隔 | 3600 | 単位は秒 |
2   | OperatorAgent - お知らせ | 最大表示件数 | 20 | 上位２０件まで |

 6. コンディション（感情メータ）  
 ![2-1-Condition](images/2-1-Condition.png)  
 直近1時間分の通話のオペレータ感情の **ポジティブ・ネガティブ（nemesysco.qa5.excitement）**  の平均値をメータ表示しています。左に振れると "ネガティブ"、右に振れると "ポジティブ" という判断になります。コンディションに関連する ControlCenter の詳細設定項目は以下です。

 No. | 設定分類                 | 設定項目名       | デフォルト値 | 内容 |
----|---------------------|------------------|--------------|------|
1   | OperatorAgent - 感情解析 | コンディションの表示 | true | false で表示しない |
2   | OperatorAgent - 感情解析 | コンディションのレッドゾーンの閾値 | 1.0 | 隠し項目 |
3| 共通 - 感情解析  | 感情解析の使用  | true  |  false = 感情解析に関するあらゆる UI を表示しない |

 7. ログインユーザプロファイル
 - ログインユーザ名表示部分をクリックするとプロフィール機能が利用できます。
 ![2-1-logininfo](images/2-1-logininfo.png)  

   1. プロフィールタブ  
	 ログイン情報の表示・画像の設定・削除・パスワード変更が実施できます。  
 ![2-1-profile](images/2-1-profile.png)  

	 パスワード変更機能に関連する ControlCenter の詳細設定項目は以下です。

 No. | 設定分類                 | 設定項目名       | デフォルト値 | 内容 |
----|---------------------|------------------|--------------|------|
1   | 共通  - セキュリティ | パスワードのポリシー | 未定義 | パスワードのフォーマット定義 |
2   | 共通  - セキュリティ | パスワードの最小桁数 | 1 |  |

   2. 設定タブ  
	 ControlCenter の詳細設定で設定された OperatorAgent の振る舞いを個人用にカスタマイズする機能になります。  
	 ![2-1-config](images/2-1-config.png)  

	 設定タブの項目と ControlCenter の詳細設定項目の関連は以下です。

 No. | 設定タブ項目 | 設定分類                 | 設定項目名       |
----|---------------------|------------------|--------------|
1   | 起動時にウィンドウを表示 | OperatorAgent - 起動時動作 | 起動時にウィンドウを表示状態に戻す |
2   | 閉じたときにタスクバーに表示しない | OperatorAgent - 全般 | 閉じたときにタスクバーに表示しない |
3   | 感情解析ポップアップを自動表示 | OperatorAgent - 通知メッセージ | 感情解析の自動表示 |
4   | 通話フィルタの通知時間 | OperatorAgent - 通知メッセージ | 通話フィルタの通知時間レベル |
5   | チャンネル名を含める | OperatorAgent - 通話全文コピー | コピー時にチャンネル名を含める |
6   | 発話開始時間を含める | OperatorAgent - 通話全文コピー | コピー時に開始時間を含める |
7   | 発話終端時間を含める | OperatorAgent - 通話全文コピー | 終了時間を含めるか |
8   | Enter キーで送信 | OperatorAgent - メッセージ | Enter キーでメッセージを送信 |

#### 1-2-2. メイン画面機能 - 通話中の機能

#### 1-2-3. メイン画面機能 - 通話終了後の機能
